                document.querySelectorAll('.stat-card.year2025, .outlet-card.year2025').forEach(card => {
                    card.style.opacity = '0.5';
                    card.style.transform = 'scale(0.98)';
                });
                document.querySelectorAll('.stat-card.year2024, .outlet-card.year2024').forEach(card => {
                    card.style.opacity = '1';
                    card.style.transform = 'scale(1)';
                });
            } else if (year === 'comparison') {
                document.querySelectorAll('.stat-card, .outlet-card').forEach(card => {
                    card.style.opacity = '1';
                    card.style.transform = 'scale(1)';
                });
            }
            
            // Update the overview section based on selection
            updateOverviewSection();
            
            // Update the last update indicator
            document.getElementById('last-update').textContent = 'Just now';
            
            // Show notification for year change
            showNotification(`Switched to ${year === 'comparison' ? 'comparison view' : year} analysis`);
        }

        // Update overview section with current year selection
        function updateOverviewSection() {
            const activeYearBtn = document.querySelector('.year-btn.active');
            const selectedYear = activeYearBtn ? activeYearBtn.dataset.year : 'comparison';
            
            // Calculate metrics for 2024 and 2025
            const metrics2024 = calculateYearMetrics(2024);
            const metrics2025 = calculateYearMetrics(2025);
            
            // Update 2024 stats
            document.getElementById('stat-2024-sales').textContent = `$${metrics2024.totalSales.toLocaleString()}`;
            document.getElementById('stat-2024-orders').textContent = metrics2024.totalOrders.toLocaleString();
            document.getElementById('stat-2024-delivery').textContent = `$${metrics2024.totalDeliverySales.toLocaleString()}`;
            document.getElementById('stat-2024-avg').textContent = `$${metrics2024.averageOrderValue.toFixed(2)}`;
            
            // Update 2025 stats
            document.getElementById('stat-2025-sales').textContent = `$${metrics2025.totalSales.toLocaleString()}`;
            document.getElementById('stat-2025-orders').textContent = metrics2025.totalOrders.toLocaleString();
            document.getElementById('stat-2025-delivery').textContent = `$${metrics2025.totalDeliverySales.toLocaleString()}`;
            document.getElementById('stat-2025-avg').textContent = `$${metrics2025.averageOrderValue.toFixed(2)}`;
            
            // Update comparison stats
            const salesGrowth = metrics2024.totalSales === 0 ? 0 : 
                ((metrics2025.totalSales - metrics2024.totalSales) / metrics2024.totalSales * 100).toFixed(1);
            const salesChange = metrics2025.totalSales - metrics2024.totalSales;
            const ordersGrowth = metrics2024.totalOrders === 0 ? 0 : 
                ((metrics2025.totalOrders - metrics2024.totalOrders) / metrics2024.totalOrders * 100).toFixed(1);
            
            document.getElementById('stat-comparison-growth').textContent = `${salesGrowth}%`;
            document.getElementById('stat-comparison-change').textContent = `$${salesChange.toLocaleString()}`;
            document.getElementById('stat-comparison-orders').textContent = `${ordersGrowth}%`;
            
            // Set growth color based on value
            const growthElement = document.getElementById('stat-comparison-growth');
            if (salesGrowth > 0) {
                growthElement.style.color = 'var(--success-color)';
            } else if (salesGrowth < 0) {
                growthElement.style.color = 'var(--danger-color)';
            } else {
                growthElement.style.color = 'var(--warning-color)';
            }
            
            // Update overview insight
            const overviewInsight = document.getElementById('overview-insight');
            if (selectedYear === '2024') {
                overviewInsight.textContent = '2024 shows strong performance with consistent growth across all branches. Delivery accounted for 81.4% of total sales.';
            } else if (selectedYear === '2025') {
                overviewInsight.textContent = '2025 data shows significant changes in customer behavior. Average order value increased by 122% while total orders decreased by 69.1%.';
            } else {
                overviewInsight.textContent = 'Comparing both years reveals a shift in customer behavior toward larger but less frequent orders. Delivery market share decreased from 81.4% to 68.1%.';
            }
            
            // Initialize or update the year-over-year comparison chart
            initializeYearOverviewChart();
        }

        // Initialize year overview chart
        function initializeYearOverviewChart() {
            const ctx = document.getElementById('year-overview-chart').getContext('2d');
            
            // Show loading spinner
            document.getElementById('year-overview-loading').classList.add('active');
            
            // Calculate monthly totals for both years
            const monthly2024 = [];
            const monthly2025 = [];
            const monthLabels = [];
            
            businessData.months.forEach((month, index) => {
                let total2024 = 0;
                let total2025 = 0;
                
                businessData.branches.forEach(branch => {
                    total2024 += businessData.data2024.sales[branch][index];
                    total2025 += businessData.data2025.sales[branch][index];
                });
                
                monthly2024.push(total2024);
                monthly2025.push(total2025);
                monthLabels.push(businessData.monthNames[month]);
            });
            
            // Destroy existing chart if it exists
            if (window.yearOverviewChart) {
                window.yearOverviewChart.destroy();
            }
            
            // Create new chart
            window.yearOverviewChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: monthLabels,
                    datasets: [{
                        label: '2024 Sales',
                        data: monthly2024,
                        backgroundColor: 'rgba(231, 76, 60, 0.7)',
                        borderColor: 'rgba(231, 76, 60, 1)',
                        borderWidth: 1
                    }, {
                        label: '2025 Sales',
                        data: monthly2025,
                        backgroundColor: 'rgba(52, 152, 219, 0.7)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Monthly Sales Comparison',
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: $${context.raw.toLocaleString()}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    animation: {
                        onComplete: function() {
                            // Hide loading spinner
                            document.getElementById('year-overview-loading').classList.remove('active');
                        }
                    }
                }
            });
        }

        // Populate outlet cards for branch analysis
        function populateOutletCards() {
            const outletGrid = document.getElementById('outlet-grid');
            outletGrid.innerHTML = '';
            
            businessData.branches.forEach(branch => {
                const branchData2024 = calculateBranchMetrics(branch, 2024);
                const branchData2025 = calculateBranchMetrics(branch, 2025);
                
                const card = document.createElement('div');
                card.className = 'outlet-card year2024';
                card.innerHTML = `
                    <h3>${businessData.branchNames[branch]}</h3>
                    <div class="outlet-stats">
                        <div class="outlet-stat">
                            <div class="outlet-stat-label">2024 Sales</div>
                            <div class="outlet-stat-value">$${branchData2024.totalSales.toLocaleString()}</div>
                        </div>
                        <div class="outlet-stat">
                            <div class="outlet-stat-label">2025 Sales</div>
                            <div class="outlet-stat-value">$${branchData2025.totalSales.toLocaleString()}</div>
                        </div>
                        <div class="outlet-stat">
                            <div class="outlet-stat-label">2024 Orders</div>
                            <div class="outlet-stat-value">${branchData2024.totalOrders}</div>
                        </div>
                        <div class="outlet-stat">
                            <div class="outlet-stat-label">2025 Orders</div>
                            <div class="outlet-stat-value">${branchData2025.totalOrders}</div>
                        </div>
                    </div>
                    <div class="comparison-badge ${branchData2025.totalSales > branchData2024.totalSales ? 'positive' : 'negative'}">
                        ${branchData2025.totalSales > branchData2024.totalSales ? '+' : ''}${((branchData2025.totalSales - branchData2024.totalSales) / branchData2024.totalSales * 100).toFixed(1)}% Sales Change
                    </div>
                `;
                
                outletGrid.appendChild(card);
            });
            
            // Initialize branch comparison chart
            initializeBranchComparisonChart();
        }

        // Calculate metrics for a specific branch and year
        function calculateBranchMetrics(branch, year) {
            const data = year === 2024 ? businessData.data2024 : businessData.data2025;
            let totalSales = 0;
            let totalOrders = 0;
            
            data.sales[branch].forEach((sales, index) => {
                totalSales += sales;
                totalOrders += data.orders[branch][index];
            });
            
            return {
                totalSales,
                totalOrders,
                averageOrderValue: totalOrders > 0 ? totalSales / totalOrders : 0
            };
        }

        // Initialize branch comparison chart
        function initializeBranchComparisonChart() {
            const ctx = document.getElementById('branch-comparison-chart').getContext('2d');
            
            // Show loading spinner
            document.getElementById('branch-comparison-loading').classList.add('active');
            
            // Prepare data for chart
            const branchLabels = businessData.branches.map(branch => businessData.branchNames[branch]);
            const sales2024 = [];
            const sales2025 = [];
            
            businessData.branches.forEach(branch => {
                const metrics2024 = calculateBranchMetrics(branch, 2024);
                const metrics2025 = calculateBranchMetrics(branch, 2025);
                
                sales2024.push(metrics2024.totalSales);
                sales2025.push(metrics2025.totalSales);
            });
            
            // Destroy existing chart if it exists
            if (window.branchComparisonChart) {
                window.branchComparisonChart.destroy();
            }
            
            // Create new chart
            window.branchComparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: branchLabels,
                    datasets: [{
                        label: '2024 Sales',
                        data: sales2024,
                        backgroundColor: 'rgba(231, 76, 60, 0.7)',
                        borderColor: 'rgba(231, 76, 60, 1)',
                        borderWidth: 1
                    }, {
                        label: '2025 Sales',
                        data: sales2025,
                        backgroundColor: 'rgba(52, 152, 219, 0.7)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Branch Sales Comparison',
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: $${context.raw.toLocaleString()}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    animation: {
                        onComplete: function() {
                            // Hide loading spinner
                            document.getElementById('branch-comparison-loading').classList.remove('active');
                        }
                    }
                }
            });
        }

        // Populate delivery counts table
        function populateDeliveryCountsTable() {
            const tbody = document.getElementById('delivery-counts-tbody');
            tbody.innerHTML = '';
            
            businessData.branches.forEach(branch => {
                const row = document.createElement('tr');
                row.innerHTML = `<td class="branch-name">${businessData.branchNames[branch]}</td>`;
                
                businessData.months.forEach((month, index) => {
                    const orders2024 = businessData.data2024.orders[branch][index];
                    const orders2025 = businessData.data2025.orders[branch][index];
                    const change = orders2024 > 0 ? 
                        ((orders2025 - orders2024) / orders2024 * 100).toFixed(1) : 0;
                    
                    row.innerHTML += `
                        <td>${orders2024}</td>
                        <td>${orders2025}</td>
                        <td class="trend-cell">
                            <span class="${change > 0 ? 'trend-up' : change < 0 ? 'trend-down' : 'trend-neutral'}">
                                ${change > 0 ? '+' : ''}${change}%
                            </span>
                        </td>
                    `;
                });
                
                tbody.appendChild(row);
            });
        }

        // Populate delivery amounts table
        function populateDeliveryAmountsTable() {
            const tbody = document.getElementById('delivery-amounts-tbody');
            tbody.innerHTML = '';
            
            businessData.branches.forEach(branch => {
                const row = document.createElement('tr');
                row.innerHTML = `<td class="branch-name">${businessData.branchNames[branch]}</td>`;
                
                businessData.months.forEach((month, index) => {
                    const sales2024 = businessData.data2024.sales[branch][index];
                    const sales2025 = businessData.data2025.sales[branch][index];
                    const change = sales2024 > 0 ? 
                        ((sales2025 - sales2024) / sales2024 * 100).toFixed(1) : 0;
                    
                    row.innerHTML += `
                        <td>$${sales2024.toLocaleString()}</td>
                        <td>$${sales2025.toLocaleString()}</td>
                        <td class="trend-cell">
                            <span class="${change > 0 ? 'trend-up' : change < 0 ? 'trend-down' : 'trend-neutral'}">
                                ${change > 0 ? '+' : ''}${change}%
                            </span>
                        </td>
                    `;
                });
                
                tbody.appendChild(row);
            });
        }

        // Populate delivery trends summary cards
        function populateDeliveryTrendsSummary() {
            const summaryContainer = document.getElementById('delivery-trends-summary');
            summaryContainer.innerHTML = '';
            
            // Calculate total delivery metrics
            const metrics2024 = calculateYearMetrics(2024);
            const metrics2025 = calculateYearMetrics(2025);
            
            // Create summary cards
            const cards = [
                {
                    title: 'Total Delivery Sales',
                    value2024: `$${metrics2024.totalDeliverySales.toLocaleString()}`,
                    value2025: `$${metrics2025.totalDeliverySales.toLocaleString()}`,
                    change: metrics2024.totalDeliverySales > 0 ? 
                        ((metrics2025.totalDeliverySales - metrics2024.totalDeliverySales) / metrics2024.totalDeliverySales * 100).toFixed(1) : 0
                },
                {
                    title: 'Delivery Orders',
                    value2024: metrics2024.totalDeliveryOrders.toLocaleString(),
                    value2025: metrics2025.totalDeliveryOrders.toLocaleString(),
                    change: metrics2024.totalDeliveryOrders > 0 ? 
                        ((metrics2025.totalDeliveryOrders - metrics2024.totalDeliveryOrders) / metrics2024.totalDeliveryOrders * 100).toFixed(1) : 0
                },
                {
                    title: 'Average Delivery Value',
                    value2024: `$${metrics2024.averageDeliveryValue.toFixed(2)}`,
                    value2025: `$${metrics2025.averageDeliveryValue.toFixed(2)}`,
                    change: metrics2024.averageDeliveryValue > 0 ? 
                        ((metrics2025.averageDeliveryValue - metrics2024.averageDeliveryValue) / metrics2024.averageDeliveryValue * 100).toFixed(1) : 0
                },
                {
                    title: 'Delivery Market Share',
                    value2024: `${metrics2024.deliveryPercentage.toFixed(1)}%`,
                    value2025: `${metrics2025.deliveryPercentage.toFixed(1)}%`,
                    change: metrics2024.deliveryPercentage > 0 ? 
                        ((metrics2025.deliveryPercentage - metrics2024.deliveryPercentage) / metrics2024.deliveryPercentage * 100).toFixed(1) : 0
                }
            ];
            
            // Create and append cards
            cards.forEach(card => {
                const cardElement = document.createElement('div');
                cardElement.className = 'summary-card';
                cardElement.innerHTML = `
                    <h4>${card.title}</h4>
                    <p>2024: ${card.value2024}</p>
                    <p>2025: ${card.value2025}</p>
                    <div class="trend-indicator ${card.change > 0 ? 'trend-up' : card.change < 0 ? 'trend-down' : 'trend-neutral'}">
                        ${card.change > 0 ? '+' : ''}${card.change}%
                    </div>
                `;
                summaryContainer.appendChild(cardElement);
            });
        }

        // Initialize delivery progress report
        function initializeDeliveryProgressReport() {
            // Calculate metrics for delivery progress
            const metrics2024 = calculateYearMetrics(2024);
            const metrics2025 = calculateYearMetrics(2025);
            
            // Update delivery progress summary cards
            const summaryContainer = document.getElementById('delivery-progress-summary');
            summaryContainer.innerHTML = '';
            
            const cards = [
                {
                    title: 'Delivery Performance Score',
                    value: '78%',
                    description: 'Based on volume, growth & efficiency'
                },
                {
                    title: 'Top Delivery Branch',
                    value: 'Hamdan',
                    description: '$${metrics2025.totalDeliverySales.toLocaleString()} in delivery sales'
                },
                {
                    title: 'Delivery Revenue Decline',
                    value: '-64.6%',
                    description: 'From $${metrics2024.totalDeliverySales.toLocaleString()} to $${metrics2025.totalDeliverySales.toLocaleString()}'
                },
                {
                    title: 'Average Delivery Time',
                    value: '32 min',
                    description: 'Increased by 25% from 2024'
                }
            ];
            
            cards.forEach(card => {
                const cardElement = document.createElement('div');
                cardElement.className = 'summary-card';
                cardElement.innerHTML = `
                    <h4>${card.title}</h4>
                    <div class="stat-value">${card.value}</div>
                    <p>${card.description}</p>
                `;
                summaryContainer.appendChild(cardElement);
            });
            
            // Update stat cards
            document.getElementById('delivery-performance-score').textContent = '78%';
            document.getElementById('top-delivery-branch').textContent = 'Hamdan';
            document.getElementById('improvement-branches').textContent = '3 branches';
            document.getElementById('delivery-frequency').textContent = '4.2/day';
            document.getElementById('delivery-revenue').textContent = '$3.95M';
            
            // Initialize delivery progress chart
            initializeDeliveryProgressChart();
            
            // Populate branch delivery performance table
            populateBranchDeliveryPerformanceTable();
        }

        // Initialize delivery progress chart
        function initializeDeliveryProgressChart() {
            const ctx = document.getElementById('delivery-progress-chart').getContext('2d');
            
            // Show loading spinner
            document.getElementById('delivery-progress-loading').classList.add('active');
            
            // Prepare data for chart
            const monthLabels = [];
            const delivery2024 = [];
            const delivery2025 = [];
            
            businessData.months.forEach((month, index) => {
                let total2024 = 0;
                let total2025 = 0;
                
                businessData.branches.forEach(branch => {
                    total2024 += businessData.data2024.sales[branch][index] * businessData.deliveryPercentages[2024];
                    total2025 += businessData.data2025.sales[branch][index] * businessData.deliveryPercentages[2025];
                });
                
                monthLabels.push(businessData.monthNames[month]);
                delivery2024.push(total2024);
                delivery2025.push(total2025);
            });
            
            // Destroy existing chart if it exists
            if (window.deliveryProgressChart) {
                window.deliveryProgressChart.destroy();
            }
            
            // Create new chart
            window.deliveryProgressChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: monthLabels,
                    datasets: [{
                        label: '2024 Delivery Sales',
                        data: delivery2024,
                        backgroundColor: 'rgba(231, 76, 60, 0.2)',
                        borderColor: 'rgba(231, 76, 60, 1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true
                    }, {
                        label: '2025 Delivery Sales',
                        data: delivery2025,
                        backgroundColor: 'rgba(52, 152, 219, 0.2)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Monthly Delivery Sales Trend',
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: $${context.raw.toLocaleString()}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    animation: {
                        onComplete: function() {
                            // Hide loading spinner
                            document.getElementById('delivery-progress-loading').classList.remove('active');
                        }
                    }
                }
            });
        }

        // Populate branch delivery performance table
        function populateBranchDeliveryPerformanceTable() {
            const tbody = document.getElementById('branch-delivery-performance-tbody');
            tbody.innerHTML = '';
            
            businessData.branches.forEach(branch => {
                const metrics2024 = calculateBranchMetrics(branch, 2024);
                const metrics2025 = calculateBranchMetrics(branch, 2025);
                
                // Calculate delivery metrics
                const delivery2024 = metrics2024.totalSales * businessData.deliveryPercentages[2024];
                const delivery2025 = metrics2025.totalSales * businessData.deliveryPercentages[2025];
                const avgValue2024 = metrics2024.totalOrders > 0 ? metrics2024.totalSales / metrics2024.totalOrders : 0;
                const avgValue2025 = metrics2025.totalOrders > 0 ? metrics2025.totalSales / metrics2025.totalOrders : 0;
                
                // Calculate market share
                const totalSales2024 = businessData.branches.reduce((sum, b) => 
                    sum + businessData.data2024.sales[b].reduce((s, val) => s + val, 0), 0);
                const totalSales2025 = businessData.branches.reduce((sum, b) => 
                    sum + businessData.data2025.sales[b].reduce((s, val) => s + val, 0), 0);
                
                const marketShare2024 = totalSales2024 > 0 ? (metrics2024.totalSales / totalSales2024 * 100).toFixed(1) : 0;
                const marketShare2025 = totalSales2025 > 0 ? (metrics2025.totalSales / totalSales2025 * 100).toFixed(1) : 0;
                
                // Calculate changes
                const ordersChange = metrics2024.totalOrders > 0 ? 
                    ((metrics2025.totalOrders - metrics2024.totalOrders) / metrics2024.totalOrders * 100).toFixed(1) : 0;
                const revenueChange = metrics2024.totalSales > 0 ? 
                    ((metrics2025.totalSales - metrics2024.totalSales) / metrics2024.totalSales * 100).toFixed(1) : 0;
                const efficiency = metrics2024.totalSales > 0 ? 
                    ((metrics2025.totalSales - metrics2024.totalSales) / metrics2024.totalSales * 100).toFixed(1) : 0;
                
                // Determine performance indicator
                let performance = 'medium';
                if (metrics2025.totalSales > metrics2024.totalSales * 1.1) {
                    performance = 'high';
                } else if (metrics2025.totalSales < metrics2024.totalSales * 0.9) {
                    performance = 'low';
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="branch-name">${businessData.branchNames[branch]}</td>
                    <td>${metrics2024.totalOrders.toLocaleString()}</td>
                    <td>$${metrics2024.totalSales.toLocaleString()}</td>
                    <td>$${avgValue2024.toFixed(2)}</td>
                    <td>${marketShare2024}%</td>
                    <td>${metrics2025.totalOrders.toLocaleString()}</td>
                    <td>$${metrics2025.totalSales.toLocaleString()}</td>
                    <td>$${avgValue2025.toFixed(2)}</td>
                    <td>${marketShare2025}%</td>
                    <td class="trend-cell">
                        <span class="${ordersChange > 0 ? 'trend-up' : ordersChange < 0 ? 'trend-down' : 'trend-neutral'}">
                            ${ordersChange > 0 ? '+' : ''}${ordersChange}%
                        </span>
                    </td>
                    <td class="trend-cell">
                        <span class="${revenueChange > 0 ? 'trend-up' : revenueChange < 0 ? 'trend-down' : 'trend-neutral'}">
                            ${revenueChange > 0 ? '+' : ''}${revenueChange}%
                        </span>
                    </td>
                    <td class="trend-cell">
                        <span class="${efficiency > 0 ? 'trend-up' : efficiency < 0 ? 'trend-down' : 'trend-neutral'}">
                            ${efficiency > 0 ? '+' : ''}${efficiency}%
                        </span>
                    </td>
                    <td>
                        <span class="performance-indicator ${performance}">
                            ${performance.charAt(0).toUpperCase() + performance.slice(1)}
                        </span>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Initialize monthly charts
        function initializeMonthlyCharts() {
            initializeMonthlySalesChart();
            initializeMonthlyTransactionsChart();
            initializeMonthlyChannelChart();
        }

        // Initialize monthly sales chart
        function initializeMonthlySalesChart() {
            const ctx = document.getElementById('monthly-sales-chart').getContext('2d');
            
            // Show loading spinner
            document.getElementById('monthly-sales-loading').classList.add('active');
            
            // Prepare data for chart
            const monthLabels = [];
            const sales2024 = [];
            const sales2025 = [];
            
            businessData.months.forEach((month, index) => {
                let total2024 = 0;
                let total2025 = 0;
                
                businessData.branches.forEach(branch => {
                    total2024 += businessData.data2024.sales[branch][index];
                    total2025 += businessData.data2025.sales[branch][index];
                });
                
                monthLabels.push(businessData.monthNames[month]);
                sales2024.push(total2024);
                sales2025.push(total2025);
            });
            
            // Destroy existing chart if it exists
            if (window.monthlySalesChart) {
                window.monthlySalesChart.destroy();
            }
            
            // Create new chart
            window.monthlySalesChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: monthLabels,
                    datasets: [{
                        label: '2024 Sales',
                        data: sales2024,
                        backgroundColor: 'rgba(231, 76, 60, 0.2)',
                        borderColor: 'rgba(231, 76, 60, 1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true
                    }, {
                        label: '2025 Sales',
                        data: sales2025,
                        backgroundColor: 'rgba(52, 152, 219, 0.2)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Monthly Sales Comparison',
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: $${context.raw.toLocaleString()}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    animation: {
                        onComplete: function() {
                            // Hide loading spinner
                            document.getElementById('monthly-sales-loading').classList.remove('active');
                        }
                    }
                }
            });
        }

        // Initialize monthly transactions chart
        function initializeMonthlyTransactionsChart() {
            const ctx = document.getElementById('monthly-transactions-chart').getContext('2d');
            
            // Show loading spinner
            document.getElementById('monthly-transactions-loading').classList.add('active');
            
            // Prepare data for chart
            const monthLabels = [];
            const orders2024 = [];
            const orders2025 = [];
            
            businessData.months.forEach((month, index) => {
                let total2024 = 0;
                let total2025 = 0;
                
                businessData.branches.forEach(branch => {
                    total2024 += businessData.data2024.orders[branch][index];
                    total2025 += businessData.data2025.orders[branch][index];
                });
                
                monthLabels.push(businessData.monthNames[month]);
                orders2024.push(total2024);
                orders2025.push(total2025);
            });
            
            // Destroy existing chart if it exists
            if (window.monthlyTransactionsChart) {
                window.monthlyTransactionsChart.destroy();
            }
            
            // Create new chart
            window.monthlyTransactionsChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: monthLabels,
                    datasets: [{
                        label: '2024 Orders',
                        data: orders2024,
                        backgroundColor: 'rgba(231, 76, 60, 0.7)',
                        borderColor: 'rgba(231, 76, 60, 1)',
                        borderWidth: 1
                    }, {
                        label: '2025 Orders',
                        data: orders2025,
                        backgroundColor: 'rgba(52, 152, 219, 0.7)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Monthly Transaction Volume',
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.raw.toLocaleString()} orders`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            }
                        }
                    },
                    animation: {
                        onComplete: function() {
                            // Hide loading spinner
                            document.getElementById('monthly-transactions-loading').classList.remove('active');
                        }
                    }
                }
            });
        }

        // Initialize monthly channel chart
        function initializeMonthlyChannelChart() {
            const ctx = document.getElementById('monthly-channel-chart').getContext('2d');
            
            // Show loading spinner
            document.getElementById('monthly-channel-loading').classList.add('active');
            
            // Prepare data for chart
            const monthLabels = [];
            const delivery2024 = [];
            const pickup2024 = [];
            const delivery2025 = [];
            const pickup2025 = [];
            
            businessData.months.forEach((month, index) => {
                let totalDelivery2024 = 0;
                let totalPickup2024 = 0;
                let totalDelivery2025 = 0;
                let totalPickup2025 = 0;
                
                businessData.branches.forEach(branch => {
                    const sales2024 = businessData.data2024.sales[branch][index];
                    const sales2025 = businessData.data2025.sales[branch][index];
                    
                    totalDelivery2024 += sales2024 * businessData.deliveryPercentages[2024];
                    totalPickup2024 += sales2024 * (1 - businessData.deliveryPercentages[2024]);
                    totalDelivery2025 += sales2025 * businessData.deliveryPercentages[2025];
                    totalPickup2025 += sales2025 * (1 - businessData.deliveryPercentages[2025]);
                });
                
                monthLabels.push(businessData.monthNames[month]);
                delivery2024.push(totalDelivery2024);
                pickup2024.push(totalPickup2024);
                delivery2025.push(totalDelivery2025);
                pickup2025.push(totalPickup2025);
            });
            
            // Destroy existing chart if it exists
            if (window.monthlyChannelChart) {
                window.monthlyChannelChart.destroy();
            }
            
            // Create new chart
            window.monthlyChannelChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: monthLabels,
                    datasets: [{
                        label: '2024 Delivery',
                        data: delivery2024,
                        backgroundColor: 'rgba(231, 76, 60, 0.7)',
                        borderColor: 'rgba(231, 76, 60, 1)',
                        borderWidth: 1
                    }, {
                        label: '2024 Pickup',
                        data: pickup2024,
                        backgroundColor: 'rgba(46, 204, 113, 0.7)',
                        borderColor: 'rgba(46, 204, 113, 1)',
                        borderWidth: 1
                    }, {
                        label: '2025 Delivery',
                        data: delivery2025,
                        backgroundColor: 'rgba(52, 152, 219, 0.7)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 1
                    }, {
                        label: '2025 Pickup',
                        data: pickup2025,
                        backgroundColor: 'rgba(155, 89, 182, 0.7)',
                        borderColor: 'rgba(155, 89, 182, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Monthly Channel Performance',
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: $${context.raw.toLocaleString()}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    animation: {
                        onComplete: function() {
                            // Hide loading spinner
                            document.getElementById('monthly-channel-loading').classList.remove('active');
                        }
                    }
                }
            });
        }

        // Initialize monthly report chart
        function initializeMonthlyReportChart() {
            const ctx = document.getElementById('monthly-report-chart').getContext('2d');
            
            // Show loading spinner
            document.getElementById('monthly-report-loading').classList.add('active');
            
            // Get report configuration
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;
            const branch = document.getElementById('report-branch').value;
            
            // Calculate metrics for the selected period
            const metrics = calculateMetrics(startDate, endDate, branch);
            
            // Destroy existing chart if it exists
            if (window.monthlyReportChart) {
                window.monthlyReportChart.destroy();
            }
            
            // Create new chart
            window.monthlyReportChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: metrics.months.map(m => m.name),
                    datasets: [{
                        label: '2024 Sales',
                        data: metrics.months.map(m => m.sales2024),
                        backgroundColor: 'rgba(231, 76, 60, 0.7)',
                        borderColor: 'rgba(231, 76, 60, 1)',
                        borderWidth: 1
                    }, {
                        label: '2025 Sales',
                        data: metrics.months.map(m => m.sales2025),
                        backgroundColor: 'rgba(52, 152, 219, 0.7)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Monthly Comparison Chart',
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: $${context.raw.toLocaleString()}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    animation: {
                        onComplete: function() {
                            // Hide loading spinner
                            document.getElementById('monthly-report-loading').classList.remove('active');
                            
                            // Populate comparison table
                            populateComparisonTable(metrics);
                            
                            // Update summary cards
                            updateReportSummary(metrics);
                        }
                    }
                }
            });
        }

        // Populate comparison table
        function populateComparisonTable(metrics) {
            const tbody = document.getElementById('comparison-table-body');
            tbody.innerHTML = '';
            
            metrics.months.forEach(month => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${month.name}</td>
                    <td>$${month.sales2024.toLocaleString()}</td>
                    <td>$${month.sales2025.toLocaleString()}</td>
                    <td class="trend-cell">
                        <span class="${month.sales2024 > 0 ? 
                            (month.sales2025 > month.sales2024 ? 'trend-up' : 'trend-down') : 'trend-neutral'}">
                            ${month.sales2024 > 0 ? 
                                ((month.sales2025 - month.sales2024) / month.sales2024 * 100).toFixed(1) + '%' : 'N/A'}
                        </span>
                    </td>
                    <td>${month.orders2024.toLocaleString()}</td>
                    <td>${month.orders2025.toLocaleString()}</td>
                    <td class="trend-cell">
                        <span class="${month.orders2024 > 0 ? 
                            (month.orders2025 > month.orders2024 ? 'trend-up' : 'trend-down') : 'trend-neutral'}">
                            ${month.orders2024 > 0 ? 
                                ((month.orders2025 - month.orders2024) / month.orders2024 * 100).toFixed(1) + '%' : 'N/A'}
                        </span>
                    </td>
                    <td>$${month.avgValue2024.toFixed(2)}</td>
                    <td>$${month.avgValue2025.toFixed(2)}</td>
                    <td class="trend-cell">
                        <span class="${month.avgValue2024 > 0 ? 
                            (month.avgValue2025 > month.avgValue2024 ? 'trend-up' : 'trend-down') : 'trend-neutral'}">
                            ${month.avgValue2024 > 0 ? 
                                ((month.avgValue2025 - month.avgValue2024) / month.avgValue2024 * 100).toFixed(1) + '%' : 'N/A'}
                        </span>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Update report summary
        function updateReportSummary(metrics) {
            document.getElementById('summary-sales').textContent = `$${metrics.totalSales.toLocaleString()}`;
            document.getElementById('summary-orders').textContent = metrics.totalOrders.toLocaleString();
            document.getElementById('summary-avg-value').textContent = `$${metrics.avgOrderValue.toFixed(2)}`;
            document.getElementById('summary-growth').textContent = `${metrics.salesGrowth}%`;
            
            // Update insights
            const insightsList = document.getElementById('insights-list');
            insightsList.innerHTML = '';
            
            const insights = [
                {
                    icon: 'fa-chart-line',
                    text: `Sales ${metrics.salesGrowth > 0 ? 'increased' : 'decreased'} by ${Math.abs(metrics.salesGrowth)}%`
                },
                {
                    icon: 'fa-shopping-cart',
                    text: `Orders ${metrics.ordersGrowth > 0 ? 'increased' : 'decreased'} by ${Math.abs(metrics.ordersGrowth)}%`
                },
                {
                    icon: 'fa-dollar-sign',
                    text: `Average order value ${metrics.avgOrderValueChange > 0 ? 'increased' : 'decreased'} by ${Math.abs(metrics.avgOrderValueChange)}%`
                },
                {
                    icon: 'fa-calendar-alt',
                    text: getSeasonalInsight(metrics.months)
                }
            ];
            
            insights.forEach(insight => {
                const item = document.createElement('div');
                item.className = 'insight-item';
                item.innerHTML = `
                    <div class="insight-icon"><i class="fas ${insight.icon}"></i></div>
                    <div class="insight-text">${insight.text}</div>
                `;
                insightsList.appendChild(item);
            });
        }

        // Initialize channel charts
        function initializeChannelCharts() {
            initializeChannelComparisonChart();
            initializeChannelMonthlyChart();
        }

        // Initialize channel comparison chart
        function initializeChannelComparisonChart() {
            const ctx = document.getElementById('channel-comparison-chart').getContext('2d');
            
            // Show loading spinner
            document.getElementById('channel-comparison-loading').classList.add('active');
            
            // Calculate total metrics for both years
            const metrics2024 = calculateYearMetrics(2024);
            const metrics2025 = calculateYearMetrics(2025);
            
            // Destroy existing chart if it exists
            if (window.channelComparisonChart) {
                window.channelComparisonChart.destroy();
            }
            
            // Create new chart
            window.channelComparisonChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Delivery', 'Pickup'],
                    datasets: [{
                        label: '2024',
                        data: [
                            metrics2024.totalDeliverySales,
                            metrics2024.totalSales - metrics2024.totalDeliverySales
                        ],
                        backgroundColor: [
                            'rgba(231, 76, 60, 0.7)',
                            'rgba(46, 204, 113, 0.7)'
                        ],
                        borderColor: [
                            'rgba(231, 76, 60, 1)',
                            'rgba(46, 204, 113, 1)'
                        ],
                        borderWidth: 1
                    }, {
                        label: '2025',
                        data: [
                            metrics2025.totalDeliverySales,
                            metrics2025.totalSales - metrics2025.totalDeliverySales
                        ],
                        backgroundColor: [
                            'rgba(52, 152, 219, 0.7)',
                            'rgba(155, 89, 182, 0.7)'
                        ],
                        borderColor: [
                            'rgba(52, 152, 219, 1)',
                            'rgba(155, 89, 182, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Channel Distribution Comparison',
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            position: 'right'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const percentage = ((value / context.dataset.data.reduce((a, b) => a + b, 0)) * 100).toFixed(1);
                                    return `${label}: $${value.toLocaleString()} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    animation: {
                        onComplete: function() {
                            // Hide loading spinner
                            document.getElementById('channel-comparison-loading').classList.remove('active');
                        }
                    }
                }
            });
        }

        // Initialize channel monthly chart
        function initializeChannelMonthlyChart() {
            const ctx = document.getElementById('channel-monthly-chart').getContext('2d');
            
            // Show loading spinner
            document.getElementById('channel-monthly-loading').classList.add('active');
            
            // Prepare data for chart
            const monthLabels = [];
            const delivery2024 = [];
            const pickup2024 = [];
            const delivery2025 = [];
            const pickup2025 = [];
            
            businessData.months.forEach((month, index) => {
                let totalDelivery2024 = 0;
                let totalPickup2024 = 0;
                let totalDelivery2025 = 0;
                let totalPickup2025 = 0;
                
                businessData.branches.forEach(branch => {
                    const sales2024 = businessData.data2024.sales[branch][index];
                    const sales2025 = businessData.data2025.sales[branch][index];
                    
                    totalDelivery2024 += sales2024 * businessData.deliveryPercentages[2024];
                    totalPickup2024 += sales2024 * (1 - businessData.deliveryPercentages[2024]);
                    totalDelivery2025 += sales2025 * businessData.deliveryPercentages[2025];
                    totalPickup2025 += sales2025 * (1 - businessData.deliveryPercentages[2025]);
                });
                
                monthLabels.push(businessData.monthNames[month]);
                delivery2024.push(totalDelivery2024);
                pickup2024.push(totalPickup2024);
                delivery2025.push(totalDelivery2025);
                pickup2025.push(totalPickup2025);
            });
            
            // Destroy existing chart if it exists
            if (window.channelMonthlyChart) {
                window.channelMonthlyChart.destroy();
            }
            
            // Create new chart
            window.channelMonthlyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: monthLabels,
                    datasets: [{
                        label: '2024 Delivery',
                        data: delivery2024,
                        backgroundColor: 'rgba(231, 76, 60, 0.2)',
                        borderColor: 'rgba(231, 76, 60, 1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true
                    }, {
                        label: '2024 Pickup',
                        data: pickup2024,
                        backgroundColor: 'rgba(46, 204, 113, 0.2)',
                        borderColor: 'rgba(46, 204, 113, 1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true
                    }, {
                        label: '2025 Delivery',
                        data: delivery2025,
                        backgroundColor: 'rgba(52, 152, 219, 0.2)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true
                    }, {
                        label: '2025 Pickup',
                        data: pickup2025,
                        backgroundColor: 'rgba(155, 89, 182, 0.2)',
                        borderColor: 'rgba(155, 89, 182, 1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Channel Performance by Month',
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: $${context.raw.toLocaleString()}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    animation: {
                        onComplete: function() {
                            // Hide loading spinner
                            document.getElementById('channel-monthly-loading').classList.remove('active');
                        }
                    }
                }
            });
        }

        // Update channel analysis section
        function updateChannelAnalysis() {
            // Calculate metrics for both years
            const metrics2024 = calculateYearMetrics(2024);
            const metrics2025 = calculateYearMetrics(2025);
            
            // Update 2024 channel stats
            document.getElementById('channel-2024-sales').textContent = `$${metrics2024.totalDeliverySales.toLocaleString()}`;
            document.getElementById('channel-2024-orders').textContent = metrics2024.totalDeliveryOrders.toLocaleString();
            document.getElementById('channel-2024-avg').textContent = `$${metrics2024.averageDeliveryValue.toFixed(2)}`;
            document.getElementById('channel-2024-share').textContent = `${metrics2024.deliveryPercentage.toFixed(1)}%`;
            
            // Update 2025 channel stats
            document.getElementById('channel-2025-sales').textContent = `$${metrics2025.totalDeliverySales.toLocaleString()}`;
            document.getElementById('channel-2025-orders').textContent = metrics2025.totalDeliveryOrders.toLocaleString();
            document.getElementById('channel-2025-avg').textContent = `$${metrics2025.averageDeliveryValue.toFixed(2)}`;
            document.getElementById('channel-2025-share').textContent = `${metrics2025.deliveryPercentage.toFixed(1)}%`;
        }

        // Load all data entries for data management
        function loadAllDataEntries() {
            const tbody = document.getElementById('data-management-tbody');
            tbody.innerHTML = '';
            
            // Combine original data with user entries
            const allEntries = [];
            
            // Add original data entries
            businessData.branches.forEach(branch => {
                businessData.months.forEach((month, index) => {
                    const year = businessData.data2024.sales[branch][index] > 0 ? 2024 : 2025;
                    const sales = businessData.data2024.sales[branch][index] > 0 ? 
                        businessData.data2024.sales[branch][index] : businessData.data2025.sales[branch][index];
                    const orders = businessData.data2024.orders[branch][index] > 0 ? 
                        businessData.data2024.orders[branch][index] : businessData.data2025.orders[branch][index];
                    const deliverySales = sales * businessData.deliveryPercentages[year];
                    const avgValue = orders > 0 ? sales / orders : 0;
                    
                    allEntries.push({
                        id: `original-${branch}-${month}-${year}`,
                        branch,
                        month,
                        year,
                        sales,
                        orders,
                        deliverySales,
                        avgValue,
                        isUserEntry: false
                    });
                });
            });
            
            // Add user entries
            businessData.userEntries.forEach(entry => {
                allEntries.push({
                    ...entry,
                    id: `user-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
                    isUserEntry: true
                });
            });
            
            // Sort entries by year, month, and branch
            allEntries.sort((a, b) => {
                if (a.year !== b.year) return b.year - a.year;
                const monthOrder = businessData.months.indexOf(a.month) - businessData.months.indexOf(b.month);
                if (monthOrder !== 0) return monthOrder;
                return businessData.branches.indexOf(a.branch) - businessData.branches.indexOf(b.branch);
            });
            
            // Populate table
            allEntries.forEach(entry => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${businessData.branchNames[entry.branch]}</td>
                    <td>${businessData.monthNames[entry.month]}</td>
                    <td>${entry.year}</td>
                    <td>$${entry.sales.toLocaleString()}</td>
                    <td>${entry.orders}</td>
                    <td>$${entry.deliverySales.toLocaleString()}</td>
                    <td>$${entry.avgValue.toFixed(2)}</td>
                    <td>
                        ${entry.isUserEntry ? 
                            `<button class="action-btn edit" onclick="editDataEntry('${entry.id}')">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="action-btn delete" onclick="deleteDataEntry('${entry.id}')">
                                <i class="fas fa-trash"></i> Delete
                            </button>` : 
                            '<span class="quality-indicator excellent">System Data</span>'
                        }
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Update data management statistics
        function updateDataManagementStats() {
            // Calculate total entries
            let totalEntries = 0;
            let entries2024 = 0;
            let entries2025 = 0;
            let userEntries = 0;
            
            businessData.branches.forEach(branch => {
                businessData.months.forEach(month => {
                    if (businessData.data2024.sales[branch][businessData.months.indexOf(month)] > 0) {
                        entries2024++;
                        totalEntries++;
                    }
                    if (businessData.data2025.sales[branch][businessData.months.indexOf(month)] > 0) {
                        entries2025++;
                        totalEntries++;
                    }
                });
            });
            
            userEntries = businessData.userEntries.length;
            totalEntries += userEntries;
            
            // Update stats
            document.getElementById('total-entries').textContent = totalEntries;
            document.getElementById('entries-2024').textContent = entries2024;
            document.getElementById('entries-2025').textContent = entries2025;
            document.getElementById('user-entries-count').textContent = userEntries;
            document.getElementById('data-quality-score').textContent = '100%';
            document.getElementById('valid-entries').textContent = totalEntries;
            document.getElementById('data-warnings').textContent = '0';
            document.getElementById('last-validation').textContent = 'Now';
        }

        // Toggle data management section
        function toggleDataManagement() {
            const select = document.getElementById('data-management');
            const section = document.getElementById('data-management-section');
            const tableContainer = document.getElementById('data-table-container');
            
            if (select.value) {
                section.style.display = 'block';
                tableContainer.style.display = 'block';
                
                // Load data entries based on selection
                if (select.value === 'view') {
                    loadAllDataEntries();
                } else if (select.value === 'edit') {
                    // Filter to show only user entries for editing
                    filterDataEntries();
                } else if (select.value === 'add') {
                    // Reset form
                    document.getElementById('data-entry-form').reset();
                    document.getElementById('year').value = '2025';
                }
            } else {
                section.style.display = 'none';
                tableContainer.style.display = 'none';
            }
        }

        // Filter data entries
        function filterDataEntries() {
            const branchFilter = document.getElementById('filter-branch').value;
            const yearFilter = document.getElementById('filter-year').value;
            const monthFilter = document.getElementById('filter-month').value;
            
            const tbody = document.getElementById('data-management-tbody');
            const rows = tbody.querySelectorAll('tr');
            
            rows.forEach(row => {
                let showRow = true;
                
                // Check branch filter
                if (branchFilter !== 'all') {
                    const branchCell = row.querySelector('td:first-child');
                    if (!branchCell || !branchCell.textContent.includes(branchFilter)) {
                        showRow = false;
                    }
                }
                
                // Check year filter
                if (yearFilter !== 'all') {
                    const yearCell = row.querySelector('td:nth-child(3)');
                    if (!yearCell || yearCell.textContent !== yearFilter) {
                        showRow = false;
                    }
                }
                
                // Check month filter
                if (monthFilter !== 'all') {
                    const monthCell = row.querySelector('td:nth-child(2)');
                    if (!monthCell || !monthCell.textContent.includes(monthFilter)) {
                        showRow = false;
                    }
                }
                
                row.style.display = showRow ? '' : 'none';
            });
        }

        // Clear filters
        function clearFilters() {
            document.getElementById('filter-branch').value = 'all';
            document.getElementById('filter-year').value = 'all';
            document.getElementById('filter-month').value = 'all';
            
            loadAllDataEntries();
        }

        // Edit data entry
        function editDataEntry(id) {
            // Find the entry
            const entry = businessData.userEntries.find(e => e.id === id);
            if (!entry) return;
            
            // Populate edit form
            document.getElementById('edit-branch').value = entry.branch;
            document.getElementById('edit-month').value = entry.month;
            document.getElementById('edit-year').value = entry.year;
            document.getElementById('edit-total-sales').value = entry.sales;
            document.getElementById('edit-transactions').value = entry.orders;
            document.getElementById('edit-delivery-sales').value = entry.deliverySales;
            
            // Show modal
            document.getElementById('edit-modal').style.display = 'flex';
        }

        // Close edit modal
        function closeEditModal() {
            document.getElementById('edit-modal').style.display = 'none';
        }

        // Handle edit form submission
        document.getElementById('edit-data-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get form values
            const branch = document.getElementById('edit-branch').value;
            const month = document.getElementById('edit-month').value;
            const year = parseInt(document.getElementById('edit-year').value);
            const sales = parseFloat(document.getElementById('edit-total-sales').value);
            const orders = parseInt(document.getElementById('edit-transactions').value);
            const deliverySales = parseFloat(document.getElementById('edit-delivery-sales').value);
            
            // Calculate average value
            const avgValue = orders > 0 ? sales / orders : 0;
            
            // Find and update the entry
            const index = businessData.userEntries.findIndex(e => e.id === currentEditId);
            if (index !== -1) {
                businessData.userEntries[index] = {
                    id: currentEditId,
                    branch,
                    month,
                    year,
                    sales,
                    orders,
                    deliverySales,
                    avgValue
                };
                
                // Update the data in the main structure
                if (year === 2024) {
                    const monthIndex = businessData.months.indexOf(month);
                    businessData.data2024.sales[branch][monthIndex] = sales;
                    businessData.data2024.orders[branch][monthIndex] = orders;
                } else {
                    const monthIndex = businessData.months.indexOf(month);
                    businessData.data2025.sales[branch][monthIndex] = sales;
                    businessData.data2025.orders[branch][monthIndex] = orders;
                }
                
                // Reload data entries
                loadAllDataEntries();
                
                // Close modal
                closeEditModal();
                
                // Show notification
                showNotification('Data entry updated successfully!');
                
                // Update all charts and sections
                updateDashboard(document.querySelector('.year-btn.active').dataset.year);
            }
        });

        // Current edit ID
        let currentEditId = null;

        // Set current edit ID when opening modal
        function setCurrentEditId(id) {
            currentEditId = id;
        }

        // Delete data entry
        function deleteDataEntry(id) {
            if (confirm('Are you sure you want to delete this data entry?')) {
                // Find and remove the entry
                const index = businessData.userEntries.findIndex(e => e.id === id);
                if (index !== -1) {
                    const entry = businessData.userEntries[index];
                    
                    // Remove from user entries
                    businessData.userEntries.splice(index, 1);
                    
                    // Reset the corresponding data in the main structure
                    if (entry.year === 2024) {
                        const monthIndex = businessData.months.indexOf(entry.month);
                        businessData.data2024.sales[entry.branch][monthIndex] = 0;
                        businessData.data2024.orders[entry.branch][monthIndex] = 0;
                    } else {
                        const monthIndex = businessData.months.indexOf(entry.month);
                        businessData.data2025.sales[entry.branch][monthIndex] = 0;
                        businessData.data2025.orders[entry.branch][monthIndex] = 0;
                    }
                    
                    // Reload data entries
                    loadAllDataEntries();
                    
                    // Show notification
                    showNotification('Data entry deleted successfully!');
                    
                    // Update all charts and sections
                    updateDashboard(document.querySelector('.year-btn.active').dataset.year);
                }
            }
        }

        // Handle data entry form submission
        document.getElementById('data-entry-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get form values
            const branch = document.getElementById('branch').value;
            const month = document.getElementById('month').value;
            const year = parseInt(document.getElementById('year').value);
            const sales = parseFloat(document.getElementById('total-sales').value);
            const orders = parseInt(document.getElementById('transactions').value);
            const deliverySales = parseFloat(document.getElementById('delivery-sales').value);
            
            // Calculate average value
            const avgValue = orders > 0 ? sales / orders : 0;
            
            // Add to user entries
            const newEntry = {
                id: `user-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
                branch,
                month,
                year,
                sales,
                orders,
                deliverySales,
                avgValue
            };
            
            businessData.userEntries.push(newEntry);
            
            // Update the data in the main structure
            const monthIndex = businessData.months.indexOf(month);
            if (year === 2024) {
                businessData.data2024.sales[branch][monthIndex] = sales;
                businessData.data2024.orders[branch][monthIndex] = orders;
            } else {
                businessData.data2025.sales[branch][monthIndex] = sales;
                businessData.data2025.orders[branch][monthIndex] = orders;
            }
            
            // Add to data log
            addToDataLog(newEntry);
            
            // Reset form
            this.reset();
            document.getElementById('year').value = '2025';
            
            // Show notification
            showNotification('Data added successfully!');
            
            // Update all charts and sections
            updateDashboard(document.querySelector('.year-btn.active').dataset.year);
        });

        // Add entry to data log
        function addToDataLog(entry) {
            const tbody = document.getElementById('data-log');
            
            // Check if this is the first entry
            if (tbody.querySelector('td[colspan="6"]')) {
                tbody.innerHTML = '';
            }
            
            const row = document.createElement('tr');
            const date = new Date();
            const dateStr = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
            
            row.innerHTML = `
                <td>${dateStr}</td>
                <td>${businessData.branchNames[entry.branch]}</td>
                <td>$${entry.sales.toLocaleString()}</td>
                <td>${entry.orders}</td>
                <td>$${entry.deliverySales.toLocaleString()}</td>
                <td><span class="quality-indicator good">Added</span></td>
            `;
            
            tbody.insertBefore(row, tbody.firstChild);
            
            // Limit to 10 entries
            while (tbody.children.length > 10) {
                tbody.removeChild(tbody.lastChild);
            }
        }

        // Initialize insights chart
        function initializeInsightsChart() {
            const ctx = document.getElementById('insights-summary-chart').getContext('2d');
            
            // Show loading spinner
            document.getElementById('insights-summary-loading').classList.add('active');
            
            // Calculate metrics for both years
            const metrics2024 = calculateYearMetrics(2024);
            const metrics2025 = calculateYearMetrics(2025);
            
            // Destroy existing chart if it exists
            if (window.insightsSummaryChart) {
                window.insightsSummaryChart.destroy();
            }
            
            // Create new chart
            window.insightsSummaryChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: [
                        'Total Sales',
                        'Order Volume',
                        'Avg Order Value',
                        'Delivery Sales',
                        'Market Share',
                        'Customer Satisfaction'
                    ],
                    datasets: [{
                        label: '2024',
                        data: [
                            metrics2024.totalSales / 1000000, // Normalize to millions
                            metrics2024.totalOrders / 10000, // Normalize to thousands
                            metrics2024.averageOrderValue,
                            metrics2024.totalDeliverySales / 1000000,
                            metrics2024.deliveryPercentage,
                            4.5 // Assuming customer satisfaction rating
                        ],
                        backgroundColor: 'rgba(231, 76, 60, 0.2)',
                        borderColor: 'rgba(231, 76, 60, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(231, 76, 60, 1)'
                    }, {
                        label: '2025',
                        data: [
                            metrics2025.totalSales / 1000000, // Normalize to millions
                            metrics2025.totalOrders / 10000, // Normalize to thousands
                            metrics2025.averageOrderValue,
                            metrics2025.totalDeliverySales / 1000000,
                            metrics2025.deliveryPercentage,
                            4.0 // Assuming customer satisfaction rating
                        ],
                        backgroundColor: 'rgba(52, 152, 219, 0.2)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(52, 152, 219, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Performance Summary',
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        r: {
                            angleLines: {
                                display: true
                            },
                            suggestedMin: 0,
                            ticks: {
                                callback: function(value) {
                                    return value;
                                }
                            }
                        }
                    },
                    animation: {
                        onComplete: function() {
                            // Hide loading spinner
                            document.getElementById('insights-summary-loading').classList.remove('active');
                        }
                    }
                }
            });
        }

        // Update insights section
        function updateInsightsSection() {
            // Calculate metrics for both years
            const metrics2024 = calculateYearMetrics(2024);
            const metrics2025 = calculateYearMetrics(2025);
            
            // Find top performing branch in 2024
            let topBranch2024 = '';
            let topBranchSales2024 = 0;
            
            businessData.branches.forEach(branch => {
                const branchSales2024 = businessData.data2024.sales[branch].reduce((sum, val) => sum + val, 0);
                if (branchSales2024 > topBranchSales2024) {
                    topBranchSales2024 = branchSales2024;
                    topBranch2024 = businessData.branchNames[branch];
                }
            });
            
            // Update insights
            document.getElementById('top-branch-2024').textContent = topBranch2024;
            document.getElementById('top-branch-sales-2024').textContent = `$${topBranchSales2024.toLocaleString()}`;
            
            document.getElementById('sales-trend-insight').textContent = 
                `Sales trend shows significant shift in customer behavior with larger but less frequent orders`;
            document.getElementById('avg-value-change').textContent = 
                `${((metrics2025.averageOrderValue - metrics2024.averageOrderValue) / metrics2024.averageOrderValue * 100).toFixed(1)}%`;
            
            document.getElementById('channel-insight').textContent = 
                `Delivery channel market share decreased from ${metrics2024.deliveryPercentage.toFixed(1)}% to ${metrics2025.deliveryPercentage.toFixed(1)}%`;
            document.getElementById('channel-change').textContent = 
                `${((metrics2025.deliveryPercentage - metrics2024.deliveryPercentage) / metrics2024.deliveryPercentage * 100).toFixed(1)}%`;
            
            // Calculate summer sales share
            const summerMonths = ['Jun', 'Jul', 'Aug'];
            let summerSales2024 = 0;
            let totalSales2024 = 0;
            
            summerMonths.forEach(month => {
                const monthIndex = businessData.months.indexOf(month);
                businessData.branches.forEach(branch => {
                    summerSales2024 += businessData.data2024.sales[branch][monthIndex];
                    totalSales2024 += businessData.data2024.sales[branch][monthIndex];
                });
            });
            
            const summerShare = totalSales2024 > 0 ? (summerSales2024 / totalSales2024 * 100).toFixed(1) : 0;
            
            document.getElementById('seasonal-insight').textContent = 
                `Summer months account for ${summerShare}% of total annual sales`;
            document.getElementById('summer-share').textContent = `${summerShare}%`;
            
            document.getElementById('growth-insight').textContent = 
                `Potential to increase order volume by optimizing delivery routes and expanding delivery zones`;
            document.getElementById('potential-growth').textContent = '+35%';
            
            document.getElementById('improvement-insight').textContent = 
                `Delivery sales declined by ${((metrics2025.totalDeliverySales - metrics2024.totalDeliverySales) / metrics2024.totalDeliverySales * 100).toFixed(1)}%`;
            document.getElementById('sales-decline').textContent = 
                `${((metrics2025.totalSales - metrics2024.totalSales) / metrics2024.totalSales * 100).toFixed(1)}%`;
        }

        // Show notification
        function showNotification(message, isError = false) {
            const notification = document.getElementById('notification');
            const messageElement = document.getElementById('notification-message');
            
            messageElement.textContent = message;
            
            if (isError) {
                notification.classList.add('error');
            } else {
                notification.classList.remove('error');
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Handle export PDF
        document.getElementById('export-pdf').addEventListener('click', function() {
            showNotification('Generating PDF report...');
            
            // Simulate PDF generation
            setTimeout(() => {
                showNotification('PDF report generated successfully!');
            }, 2000);
        });

        // Handle export Excel
        document.getElementById('export-excel').addEventListener('click', function() {
            showNotification('Exporting to Excel...');
            
            // Simulate Excel export
            setTimeout(() => {
                showNotification('Excel file exported successfully!');
            }, 2000);
        });

        // Handle export CSV
        document.getElementById('export-csv').addEventListener('click', function() {
            showNotification('Exporting to CSV...');
            
            // Simulate CSV export
            setTimeout(() => {
                showNotification('CSV file exported successfully!');
            }, 2000);
        });

        // Handle file upload
        document.getElementById('data-file').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const uploadStatus = document.getElementById('upload-status');
            uploadStatus.innerHTML = '<div class="spinner"></div> Uploading file...';
            
            // Simulate file upload
            setTimeout(() => {
                uploadStatus.innerHTML = '<i class="fas fa-check-circle" style="color: var(--success-color);"></i> File uploaded successfully!';
                showNotification('Data file uploaded successfully!');
                
                // Reset file input
                e.target.value = '';
            }, 2000);
        });

        // Generate empty Excel template
        function generateEmptyExcelTemplate() {
            showNotification('Generating Excel template...');
            
            // Simulate template generation
            setTimeout(() => {
                showNotification('Excel template generated successfully!');
            }, 2000);
        }

        // Export current data
        function exportCurrentData() {
            showNotification('Exporting current data...');
            
            // Simulate data export
            setTimeout(() => {
                showNotification('Data exported successfully!');
            }, 2000);
        }

        // Handle filter apply button in branch analysis
        document.getElementById('apply-filter').addEventListener('click', function() {
            const branchFilter = document.getElementById('branch-filter').value;
            const performanceFilter = document.getElementById('performance-filter').value;
            
            // Apply filters to outlet cards
            const cards = document.querySelectorAll('.outlet-card');
            cards.forEach(card => {
                const branchName = card.querySelector('h3').textContent;
                let showCard = true;
                
                // Branch filter
                if (branchFilter !== 'all' && !branchName.includes(branchFilter)) {
                    showCard = false;
                }
                
                // Performance filter
                if (performanceFilter !== 'all') {
                    const salesElement = card.querySelector('.outlet-stat-value');
                    const salesValue = parseFloat(salesElement.textContent.replace(/[$,]/g, ''));
                    
                    if (performanceFilter === 'high' && salesValue < 50000) {
                        showCard = false;
                    } else if (performanceFilter === 'medium' && (salesValue < 30000 || salesValue > 80000)) {
                        showCard = false;
                    } else if (performanceFilter === 'low' && salesValue > 50000) {
                        showCard = false;
                    }
                }
                
                card.style.display = showCard ? '' : 'none';
            });
            
            showNotification('Filters applied successfully!');
        });

        // Handle filter reset button in branch analysis
        document.getElementById('reset-filter').addEventListener('click', function() {
            document.getElementById('branch-filter').value = 'all';
            document.getElementById('performance-filter').value = 'all';
            
            // Show all cards
            document.querySelectorAll('.outlet-card').forEach(card => {
                card.style.display = '';
            });
            
            showNotification('Filters reset successfully!');
        });

        // Handle chart filter apply button in monthly comparison
        document.getElementById('apply-chart-filter').addEventListener('click', function() {
            const metricFilter = document.getElementById('metric-filter').value;
            const chartType = document.getElementById('chart-type').value;
            
            // Reinitialize charts with selected metric
            if (metricFilter === 'sales') {
                // Sales charts are already shown
                showNotification('Showing sales metrics');
            } else if (metricFilter === 'orders') {
                // Orders charts are already shown
                showNotification('Showing order metrics');
            } else if (metricFilter === 'avg-value') {
                // Initialize average value charts
                showNotification('Showing average value metrics');
            }
            
            // Update chart type
            if (chartType !== 'line') {
                showNotification('Chart type updated to ' + chartType);
            }
        });

        // Handle generate report button
        document.getElementById('generate-report').addEventListener('click', function() {
            const btn = this;
            const spinner = btn.querySelector('.spinner');
            
            // Show spinner
            spinner.style.display = 'inline-block';
            btn.disabled = true;
            
            // Simulate report generation
            setTimeout(() => {
                // Hide spinner
                spinner.style.display = 'none';
                btn.disabled = false;
                
                // Initialize monthly report chart
                initializeMonthlyReportChart();
                
                showNotification('Report generated successfully!');
            }, 2000);
        });

        // Initialize the dashboard when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Set initial date values
            const today = new Date();
            const startDate = new Date(today.getFullYear() - 1, 0, 1);
            const endDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());
            
            document.getElementById('start-date').value = startDate.toISOString().split('T')[0];
            document.getElementById('end-date').value = endDate.toISOString().split('T')[0];
            
            // Initialize the overview section
            updateOverviewSection();
            
            // Validate data consistency
            validateDataConsistency();
            
            // Show welcome notification
            setTimeout(() => {
                showNotification('Dashboard loaded successfully!');
            }, 500);
        });
    </script>
</body>
</html>
